<html>
<head>
	<title>Test</title>
	<link href="css/style.css" rel="stylesheet" type="text/css">
	<script src="js/jquery.js"></script>
</head>
<body>
</body>
<script src="/socket.io/socket.io.js"></script>
<script src="http://cdn.binaryjs.com/0/binary.js"></script>
<script>
    // Connect to Binary.js server
    var client = new BinaryClient('ws://localhost:9000');
		var parts = [];
    // Received new stream from server!
    client.on('stream', function(stream, meta){    
      // Buffer for parts
      // Got new data
      stream.on('data', function(data){
				context.decodeAudioData(data, playAudio, decodeError);
        parts.push(data);
      });
      stream.on('end', function(){
        // Display new data in browser!
				console.log(parts);
      });
    });
		client.emit('stream-send', {'asdf':'asdf'});

  var context = new webkitAudioContext()
		, nextStartTime = 0
    , numSegments = 0;

  decodeError = function() {
    return console.log("Decoding failed");
  };

  playAudio = function(buffer) {
    var source;
    source = context.createBufferSource();
    source.buffer = buffer;
    source.connect(context.destination);
    source.start(nextStartTime);
    if (nextStartTime === 0) {
      return nextStartTime = context.currentTime;
    } else {
      return nextStartTime = nextStartTime + buffer.duration;
    }
  };
	
</script>
</html>
